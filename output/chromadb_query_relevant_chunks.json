{
  "collection_name": "pyspark_code_chunks",
  "total_queries": 1,
  "last_query_at": "2025-11-24T10:01:38.002074",
  "queries": [
    {
      "query": "what are the conditions for OM_16_NO_CLEAN_ORDER_CODE, explain the full logic",
      "timestamp": "2025-11-24T10:01:38.002056",
      "n_results_requested": 1,
      "n_results_retrieved": 1,
      "filter_metadata": null,
      "relevant_chunks": [
        {
          "content": " coalesce(Release_ind,' ')=0 then 'Y' else 'N' end )='Y' --Bug :-2878349\n\nunion all\n-- Need to create a table Purchase_Order_AllDates_Archive in implementaion notebook of Purchase_Order_AllDates\nselect  distinct\nSales_Document,\nItem \t\n,Getdate() as AlertDate\n,'OM_05_CHANGE_AB_CONFIRMATION' as AlertName,\n' ' as ActionHolder,\n'' as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures a\nleft join (select  PrevABDate ,Poitemkey from  alldates) b\non a.Poitemkey=b.poitemkey\nwhere lower(trim(orderlinestatus))='open'and \nif(ABConfirmationDate is not null \nand ABConfirmationDate<>b.PrevABDate and b.PrevABDate is not null \nand datediff(b.PrevABDate,ABConfirmationDate) between 0 and 7 , 'Y' , 'N' )='Y'\n\nunion all\n--********************************* this is working but count is more n synapse : 6155 in gold 8709\nselect distinct\nSales_Document,\nItem \n,getdate() as AlertDate\n,'OM_08_GI_OVERDUE' as AlertName,\n' ' as ActionHolder,\n'' as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}sales_line_measures\nleft join {catalog_table_name_sl2}.t_static_vendor_type A\non Trim(A.LIFNR)=cast((case when VendorID is null and coalesce(Fixed_vendor,'') <> '' then replace(Ltrim(replace(Fixed_vendor,'0',' ')),' ','0')\n      when vendorID is null and coalesce(Vendor_Account_Number,'') <> '' then replace(Ltrim(replace(Vendor_Account_Number,'0',' ')),' ','0')\n      else replace(Ltrim(replace(Vendor,'0',' ')),' ','0')end  )as int)\nwhere lower(trim(orderlinestatus))='open' and (case when GIRelevantFlag='Y' and (Rejection_Reason is null or Rejection_Reason =' ') and (date_part('month',BillingCreationDate)=date_part('month',getdate()) or \ndate_part('month',BillingCreationDate)=date_part('month',getdate())-1)\nthen (case when coalesce(A.VENDOR_TYPE,' ')=' ' then 'N'\n          when  coalesce(A.VENDOR_TYPE,' ')='CME' and storageLocationID ='SITE' \n          --GR relevance check GR Receipt = ‘No’\n\t\t\t\t\tthen (case when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C' and ActualGoodsIssueDate is null  and Plant='DX96' \n                         and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n                       --GR relevance check GR Receipt = ‘No’\n\t\t\t\t\t             when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'and ActualGoodsIssueDate is null  and Plant<>'DX96' then 'Y' \n                       --GR relevance check GR Receipt = ‘Yes’\n                       when PoHistory like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C' and ActualGoodsIssueDate is null and Plant='DX96' and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n                       --GR relevance check GR Receipt = ‘yes’\n\t\t\t\t\t             when PoHistory like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C' and ActualGoodsIssueDate is null and Plant<>'DX96' then 'Y' else 'N' end\n                )\n          when coalesce(A.VENDOR_TYPE,' ')='CME' and  storageLocationID <> 'SITE' \n          --GR relevance check GR Receipt = ‘No’\n\t\t\t\t\tthen ( case when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant='DX96' and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n\t\t\t\t\t            when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant<>'DX96' then 'Y' else 'N' end\n              )\n          when coalesce(A.VENDOR_TYPE,' ') not in ('CME') --and  storageLocationID <> 'SITE' \n          --GR relevance check GR Receipt = ‘No’\n\t\t\t\t\tthen ( case when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant='DX96' and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n\t\t\t\t\t            when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant<>'DX96' then 'Y'\n\t\t\t\t\t\t\t\t      when PoHistory not like'%E%'and Plant='USM1' and storageLocationID ='MAIN' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant='DX96' and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n\t\t\t\t\t\t\t\t     when PoHistory not like'%E%' and Plant='USM1' and storageLocationID ='MAIN' and coalesce \n                      (Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant<>'DX96' then 'Y' else 'N' end) else 'N'end \n               ) else 'N'\n\tend ) ='Y' \n\nunion all\n--*********************************As per US 3358600 GR_OVERDUE needs to be changed as GR_DUE. since these alerts are used in some of history tables, it cannot be renamed in Backend .Changes are done in powerbi for this****************\nselect\n      distinct Sales_Document,\n      Item,\n      getdate() as AlertDate,\n'OM_06_GR_OVERDUE' as AlertName, \ncase when Purchasing_Doc is not null\n          and Goods_Receipt = 'X'\n          and upper(Onhold) = 'NO'\n          and ActualGoodsReceiptDate is null then (\n            case\n              when storageLocationID = 'SITE'\n              and Acct_Grp IN ('ZNC1', 'ZNC2', 'ZNC4')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Philips Factory'\n              when storageLocationID = 'SITE'\n              and Vendor like ('%164728')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 15) then 'Resipronics'\n              when storageLocationID = 'SITE'\n              and coalesce(A.VENDOR_TYPE, '') = 'CME'\n              and Vendor like ('%168136')\n              and CDD <= date_add(current_date(), 4) then 'RDC' \n              when storageLocationID = 'SITE'\n              and coalesce(A.VENDOR_TYPE, '') <> 'CME'\n              and CDD <= date_add(current_date(), 14) then 'Third party Vendor' \n              when storageLocationID not in ('SITE')\n              and Plant not in ('USMC', 'DEMC')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Market Warehouse'\n              when storageLocationID not in ('SITE')\n              and Plant in ('USMC', 'DEMC')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Merge center'\n              else ' '\n            end\n          )\n          else ' '\n        end as ActionHolder,\n'' as AgingFlag\nfrom\n      {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures\nleft join {catalog_table_name_sl2}.t_static_vendor_type A  on Trim(A.LIFNR)=cast((case when VendorID is null and coalesce(Fixed_vendor,'') <> '' then replace(Ltrim(replace(Fixed_vendor,'0',' ')),' ','0')\n      when vendorID is null and coalesce(Vendor_Account_Number,'') <> '' then replace(Ltrim(replace(Vendor_Account_Number,'0',' ')),' ','0')\n      else replace(Ltrim(replace(Vendor,'0',' ')),' ','0')end  )as int)\n    where\n      lower(trim(orderlinestatus)) = 'open'\n      and (\n        case\n          when Purchasing_Doc is not null\n          and Goods_Receipt = 'X'\n          and upper(Onhold) = 'NO'\n          and ActualGoodsReceiptDate is null then (\n            case\n              when storageLocationID = 'SITE'\n              and Acct_Grp IN ('ZNC1', 'ZNC2', 'ZNC4')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Y' \n              when storageLocationID = 'SITE'\n              and Vendor like ('%164728')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 15) then 'Y' \n              when storageLocationID = 'SITE'\n              and coalesce(A.VENDOR_TYPE, '') = 'CME'\n              and Vendor like ('%168136')\n              and CDD <= date_add(current_date(), 4) then 'Y' \n              when storageLocationID = 'SITE'\n              and coalesce(A.VENDOR_TYPE, '') <> 'CME'\n              and CDD <= date_add(current_date(), 14) then 'Y'\n              when storageLocationID not in ('SITE')\n              and Plant not in ('USMC', 'DEMC')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Y'\n              when storageLocationID not in ('SITE')\n              and Plant in ('USMC', 'DEMC')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Y'\n              else 'N'\n            end\n          )\n          else 'N'\n        end\n      ) = 'Y'\n\nunion all\n-- ********************************* this is working but count is more n synapse : 411 in gold 11418\nselect distinct   \nsl.Sales_Document,\nItem \n,Getdate() as AlertDate\n,'OM_19_GR_COMPLETE' as AlertName,\n' ' as ActionHolder,\n'' as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures sl\nleft join\n(\nselect a.Sales_Document,array_join( collect_set(a.ActualGoodsReceiptDate), ',') as ActualGoodsReceiptDate\n  from  (\n      select distinct Sales_Document,case when ActualGoodsReceiptDate is not null then cast(ActualGoodsReceiptDate as string) else 'empty' end as ActualGoodsReceiptDate\n      from {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures\n    )a\ngroup by a.Sales_Document\n)c\n on c.Sales_Document=sl.Sales_Document\nwhere OrderLineStatus='Open' and if((Delivery_block is not null  and Delivery_block <>' '),\nif(coalesce(Complete_dlv,' ') <>'X' and Delivery_group<>'0' and c.ActualGoodsReceiptDate not like '%empty%', 'Y'\n         ,if(Complete_dlv ='X' and c.ActualGoodsReceiptDate not like '%empty%', 'Y' , 'N' )), 'N' )='Y'--Bug 3021713\n    \nunion all\n-- ********************************* this is working but count is more n synapse : 2982 in gold 2698\nselect distinct\nSales_Document,\nItem \n,Getdate() as AlertDate\n,'OM_16_NO_CLEAN_ORDER_CODE' as AlertName,\n' ' as ActionHolder,\n'' as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures SM\nleft join {catalog_table_name_sl2}.t_static_cfc_orgunit_market A\non SM.Sales_Org=A.CompanyCode\nwhere lower(trim(orderlinestatus))='open'  and if(Sales_Doc_Type in ('ZPO','ZSO') --and trim(A.CFC) = 'CFC EMEA' \nand datediff(getdate(),Item_Created_On)<31 , if(Trim(SM.Market)  in ('Benelux','DACH','France','Italy','UKI','APAC','Greater China','Japan')\n--and Header_Created_by not in ('DEMICHAELIS','DEP18494','310243563','310105498','310116302','DEBADER','DERIMMELE')\nand COALESCE(Name_Of_Orderer,' ')=' ','Y', \nif(Trim(SM.Market) in ('LATAM','NAM') and DSR_Status = 'NO','Y','N')),'N')='Y'--2632575(23-08-2023)\n\nunion all\n-- ********************************* this is working but count is more n synapse : 1 in gold 212\nselect distinct\na.Sales_Document,\na.Item\n,Getdate() as AlertDate \n,'OM_34_CDD/rCDD >SID' as AlertName,\n' ' as ActionHolder,\ncase when coalesce(B.RCDD, ' ')= ' ' and (CDD > SID) \n                        then(case when  datediff(CDD,SID)<7  then 'Green'\n                                  when  datediff(CDD,SID) between 7 and 30 then 'Yellow'\n                                  when  datediff(CDD,SID)> 30 then 'Red' end)\n\t\t\twhen coalesce(B.RCDD, ' ')<>' 'and (cast(RCDD as date) > SID) then(case when  datediff(RCDD,SID)<7  then 'Green'\n                                  when  datediff(RCDD,SID) between 7 and 30 then 'Yellow'\n                                  when  datediff(RCDD,SID)> 30 then 'Red' end) \n\t\t\t  end as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures A\nleft join  (select x.Sales_Document,x.Sales_Document_Item,x.Rcdd,x.LegCount from\n(select Sales_Document,Sales_Document_Item,Rcdd,LegCount from {catalog_table_name_gold}.{table_name_prefix_gold_src}optilo_infodis_powerbi)x\njoin\n(select Sales_Document,Sales_Document_Item,max(LegCount) as LegCount from {catalog_table_name_gold}.{table_name_prefix_gold_src}optilo_infodis_powerbi group by Sales_Document,Sales_Document_Item)y\non x.Sales_Document=y.Sales_Document and x.Sales_Document_Item=y.Sales_Document_Item and x.LegCount=y.LegCount) B\non replace(ltrim(replace(A.Sales_Document, '0', ' ')), ' ', '0')=replace(ltrim(replace(B.Sales_Document, '0', ' ')), ' ', '0') and \nreplace(ltrim(replace(A.Item, '0', ' ')), ' ', '0')=replace(ltrim(replace(B.Sales_Document_Item, '0', ' ')), ' ', '0')\nwhere lower(trim(orderlinestatus))='open'  and \nif(`GMRU.Level7` not in  ('Ultrasound','US') and   -- Updated as per the incident- INC4050771\n\t\t Sales_Doc_Type in ('ZPRO','ZPO','YCQF') and --Material not like 'SP00%'  -- US 3086455\n    SP00Identifier = 'N' and A.Higher_lev_item <> '0' and A.Item_Category not in ('YXCN','YHC2','YHNB','YHNN','YINK','YSNN','YXCK','YYCK','YYDP','YYNK','YYNO','ZMNN','ZEDC') and (case when VendorID is not null and Acct_Grp in ('ZCPD','0001') then 'YES' --step1 \n      when coalesce(Fixed_vendor,'') not in ('')  and len(replace(Ltrim(replace(Fixed_vendor,'0',' ')),' ','0'))>6 then 'YES'  --step2 EBAN \n      when Indicator_Fixed_vendor='X' and len(replace(Ltrim(replace(Vendor_Account_Number,'0',' ')),' ','0'))>6 then 'YES' --step3 EORD \n      else 'NO' end)='NO' -- Thirdpartycheck \n      and Purchasing_Doc is not null\n      and SUBSTRING(Item_Category, 2, 1) NOT IN ('1', '2', '3')\n      and ((DeliveryType = 'Direct shipment' and LAConfirmationDate is null) or (DeliveryType = 'Via Warehouse' and DeliveryDocument is null))\n      and sid not in  (' ','00000000') \n\t\t , (case when coalesce(B.RCDD, ' ')= ' ' and (CDD > SID) then 'Y'\n\t\t\t\t\twhen B.RCDD is not null and (cast(RCDD as date) > SID) then 'Y' --Incident INC4089808\n\t\t\t  end) , 'N' ) ='Y'\n\n/*union all\n\n-- ********************************* this is working but count is more n synapse : 30449 in gold 63947\nselect  distinct  \nSales_Document,\nItem \n,Getdate() as AlertDate\n,'Order_Confirmation_Intime' as AlertName,\n' ' as ActionHolder\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures\nwhere (case when lower(trim(orderlinestatus))='open' and  upper(INCP) ='NO' and coalesce(RDD,' ') <>'2035-12-31' and Purchasing_Doc is null and (Rejection_Reason is null or Rejection_Reason=' ') \nthen ( case when Sales_Doc_Type = 'ZSO' and datediff(CDD,Purchase_Order_Date)>11 then 'Y'\n            when Sales_Doc_Type = 'ZPO' and datediff(CDD,Purchase_Order_Date)>18 then 'Y' end )  \n            else 'N' end )='Y'*/  --updated as per 2996431  -- as per the BUG-3061824, commented this alert\n/*where lower(trim(orderlinestatus))='open' and if(upper(INCP) ='NO' and Sales_D",
          "text": " coalesce(Release_ind,' ')=0 then 'Y' else 'N' end )='Y' --Bug :-2878349\n\nunion all\n-- Need to create a table Purchase_Order_AllDates_Archive in implementaion notebook of Purchase_Order_AllDates\nselect  distinct\nSales_Document,\nItem \t\n,Getdate() as AlertDate\n,'OM_05_CHANGE_AB_CONFIRMATION' as AlertName,\n' ' as ActionHolder,\n'' as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures a\nleft join (select  PrevABDate ,Poitemkey from  alldates) b\non a.Poitemkey=b.poitemkey\nwhere lower(trim(orderlinestatus))='open'and \nif(ABConfirmationDate is not null \nand ABConfirmationDate<>b.PrevABDate and b.PrevABDate is not null \nand datediff(b.PrevABDate,ABConfirmationDate) between 0 and 7 , 'Y' , 'N' )='Y'\n\nunion all\n--********************************* this is working but count is more n synapse : 6155 in gold 8709\nselect distinct\nSales_Document,\nItem \n,getdate() as AlertDate\n,'OM_08_GI_OVERDUE' as AlertName,\n' ' as ActionHolder,\n'' as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}sales_line_measures\nleft join {catalog_table_name_sl2}.t_static_vendor_type A\non Trim(A.LIFNR)=cast((case when VendorID is null and coalesce(Fixed_vendor,'') <> '' then replace(Ltrim(replace(Fixed_vendor,'0',' ')),' ','0')\n      when vendorID is null and coalesce(Vendor_Account_Number,'') <> '' then replace(Ltrim(replace(Vendor_Account_Number,'0',' ')),' ','0')\n      else replace(Ltrim(replace(Vendor,'0',' ')),' ','0')end  )as int)\nwhere lower(trim(orderlinestatus))='open' and (case when GIRelevantFlag='Y' and (Rejection_Reason is null or Rejection_Reason =' ') and (date_part('month',BillingCreationDate)=date_part('month',getdate()) or \ndate_part('month',BillingCreationDate)=date_part('month',getdate())-1)\nthen (case when coalesce(A.VENDOR_TYPE,' ')=' ' then 'N'\n          when  coalesce(A.VENDOR_TYPE,' ')='CME' and storageLocationID ='SITE' \n          --GR relevance check GR Receipt = ‘No’\n\t\t\t\t\tthen (case when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C' and ActualGoodsIssueDate is null  and Plant='DX96' \n                         and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n                       --GR relevance check GR Receipt = ‘No’\n\t\t\t\t\t             when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'and ActualGoodsIssueDate is null  and Plant<>'DX96' then 'Y' \n                       --GR relevance check GR Receipt = ‘Yes’\n                       when PoHistory like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C' and ActualGoodsIssueDate is null and Plant='DX96' and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n                       --GR relevance check GR Receipt = ‘yes’\n\t\t\t\t\t             when PoHistory like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C' and ActualGoodsIssueDate is null and Plant<>'DX96' then 'Y' else 'N' end\n                )\n          when coalesce(A.VENDOR_TYPE,' ')='CME' and  storageLocationID <> 'SITE' \n          --GR relevance check GR Receipt = ‘No’\n\t\t\t\t\tthen ( case when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant='DX96' and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n\t\t\t\t\t            when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant<>'DX96' then 'Y' else 'N' end\n              )\n          when coalesce(A.VENDOR_TYPE,' ') not in ('CME') --and  storageLocationID <> 'SITE' \n          --GR relevance check GR Receipt = ‘No’\n\t\t\t\t\tthen ( case when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant='DX96' and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n\t\t\t\t\t            when PoHistory not like'%E%' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant<>'DX96' then 'Y'\n\t\t\t\t\t\t\t\t      when PoHistory not like'%E%'and Plant='USM1' and storageLocationID ='MAIN' and coalesce(Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant='DX96' and datediff(getdate(),BillingCreationDate)>3 then 'Y'\n\t\t\t\t\t\t\t\t     when PoHistory not like'%E%' and Plant='USM1' and storageLocationID ='MAIN' and coalesce \n                      (Total_goods_movement_status,' ')<>'C'  and ActualGoodsIssueDate is null and Plant<>'DX96' then 'Y' else 'N' end) else 'N'end \n               ) else 'N'\n\tend ) ='Y' \n\nunion all\n--*********************************As per US 3358600 GR_OVERDUE needs to be changed as GR_DUE. since these alerts are used in some of history tables, it cannot be renamed in Backend .Changes are done in powerbi for this****************\nselect\n      distinct Sales_Document,\n      Item,\n      getdate() as AlertDate,\n'OM_06_GR_OVERDUE' as AlertName, \ncase when Purchasing_Doc is not null\n          and Goods_Receipt = 'X'\n          and upper(Onhold) = 'NO'\n          and ActualGoodsReceiptDate is null then (\n            case\n              when storageLocationID = 'SITE'\n              and Acct_Grp IN ('ZNC1', 'ZNC2', 'ZNC4')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Philips Factory'\n              when storageLocationID = 'SITE'\n              and Vendor like ('%164728')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 15) then 'Resipronics'\n              when storageLocationID = 'SITE'\n              and coalesce(A.VENDOR_TYPE, '') = 'CME'\n              and Vendor like ('%168136')\n              and CDD <= date_add(current_date(), 4) then 'RDC' \n              when storageLocationID = 'SITE'\n              and coalesce(A.VENDOR_TYPE, '') <> 'CME'\n              and CDD <= date_add(current_date(), 14) then 'Third party Vendor' \n              when storageLocationID not in ('SITE')\n              and Plant not in ('USMC', 'DEMC')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Market Warehouse'\n              when storageLocationID not in ('SITE')\n              and Plant in ('USMC', 'DEMC')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Merge center'\n              else ' '\n            end\n          )\n          else ' '\n        end as ActionHolder,\n'' as AgingFlag\nfrom\n      {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures\nleft join {catalog_table_name_sl2}.t_static_vendor_type A  on Trim(A.LIFNR)=cast((case when VendorID is null and coalesce(Fixed_vendor,'') <> '' then replace(Ltrim(replace(Fixed_vendor,'0',' ')),' ','0')\n      when vendorID is null and coalesce(Vendor_Account_Number,'') <> '' then replace(Ltrim(replace(Vendor_Account_Number,'0',' ')),' ','0')\n      else replace(Ltrim(replace(Vendor,'0',' ')),' ','0')end  )as int)\n    where\n      lower(trim(orderlinestatus)) = 'open'\n      and (\n        case\n          when Purchasing_Doc is not null\n          and Goods_Receipt = 'X'\n          and upper(Onhold) = 'NO'\n          and ActualGoodsReceiptDate is null then (\n            case\n              when storageLocationID = 'SITE'\n              and Acct_Grp IN ('ZNC1', 'ZNC2', 'ZNC4')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Y' \n              when storageLocationID = 'SITE'\n              and Vendor like ('%164728')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 15) then 'Y' \n              when storageLocationID = 'SITE'\n              and coalesce(A.VENDOR_TYPE, '') = 'CME'\n              and Vendor like ('%168136')\n              and CDD <= date_add(current_date(), 4) then 'Y' \n              when storageLocationID = 'SITE'\n              and coalesce(A.VENDOR_TYPE, '') <> 'CME'\n              and CDD <= date_add(current_date(), 14) then 'Y'\n              when storageLocationID not in ('SITE')\n              and Plant not in ('USMC', 'DEMC')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Y'\n              when storageLocationID not in ('SITE')\n              and Plant in ('USMC', 'DEMC')\n              and ABConfirmationDate is not null\n              and ABConfirmationDate <= date_add(current_date(), 4) then 'Y'\n              else 'N'\n            end\n          )\n          else 'N'\n        end\n      ) = 'Y'\n\nunion all\n-- ********************************* this is working but count is more n synapse : 411 in gold 11418\nselect distinct   \nsl.Sales_Document,\nItem \n,Getdate() as AlertDate\n,'OM_19_GR_COMPLETE' as AlertName,\n' ' as ActionHolder,\n'' as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures sl\nleft join\n(\nselect a.Sales_Document,array_join( collect_set(a.ActualGoodsReceiptDate), ',') as ActualGoodsReceiptDate\n  from  (\n      select distinct Sales_Document,case when ActualGoodsReceiptDate is not null then cast(ActualGoodsReceiptDate as string) else 'empty' end as ActualGoodsReceiptDate\n      from {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures\n    )a\ngroup by a.Sales_Document\n)c\n on c.Sales_Document=sl.Sales_Document\nwhere OrderLineStatus='Open' and if((Delivery_block is not null  and Delivery_block <>' '),\nif(coalesce(Complete_dlv,' ') <>'X' and Delivery_group<>'0' and c.ActualGoodsReceiptDate not like '%empty%', 'Y'\n         ,if(Complete_dlv ='X' and c.ActualGoodsReceiptDate not like '%empty%', 'Y' , 'N' )), 'N' )='Y'--Bug 3021713\n    \nunion all\n-- ********************************* this is working but count is more n synapse : 2982 in gold 2698\nselect distinct\nSales_Document,\nItem \n,Getdate() as AlertDate\n,'OM_16_NO_CLEAN_ORDER_CODE' as AlertName,\n' ' as ActionHolder,\n'' as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures SM\nleft join {catalog_table_name_sl2}.t_static_cfc_orgunit_market A\non SM.Sales_Org=A.CompanyCode\nwhere lower(trim(orderlinestatus))='open'  and if(Sales_Doc_Type in ('ZPO','ZSO') --and trim(A.CFC) = 'CFC EMEA' \nand datediff(getdate(),Item_Created_On)<31 , if(Trim(SM.Market)  in ('Benelux','DACH','France','Italy','UKI','APAC','Greater China','Japan')\n--and Header_Created_by not in ('DEMICHAELIS','DEP18494','310243563','310105498','310116302','DEBADER','DERIMMELE')\nand COALESCE(Name_Of_Orderer,' ')=' ','Y', \nif(Trim(SM.Market) in ('LATAM','NAM') and DSR_Status = 'NO','Y','N')),'N')='Y'--2632575(23-08-2023)\n\nunion all\n-- ********************************* this is working but count is more n synapse : 1 in gold 212\nselect distinct\na.Sales_Document,\na.Item\n,Getdate() as AlertDate \n,'OM_34_CDD/rCDD >SID' as AlertName,\n' ' as ActionHolder,\ncase when coalesce(B.RCDD, ' ')= ' ' and (CDD > SID) \n                        then(case when  datediff(CDD,SID)<7  then 'Green'\n                                  when  datediff(CDD,SID) between 7 and 30 then 'Yellow'\n                                  when  datediff(CDD,SID)> 30 then 'Red' end)\n\t\t\twhen coalesce(B.RCDD, ' ')<>' 'and (cast(RCDD as date) > SID) then(case when  datediff(RCDD,SID)<7  then 'Green'\n                                  when  datediff(RCDD,SID) between 7 and 30 then 'Yellow'\n                                  when  datediff(RCDD,SID)> 30 then 'Red' end) \n\t\t\t  end as AgingFlag\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures A\nleft join  (select x.Sales_Document,x.Sales_Document_Item,x.Rcdd,x.LegCount from\n(select Sales_Document,Sales_Document_Item,Rcdd,LegCount from {catalog_table_name_gold}.{table_name_prefix_gold_src}optilo_infodis_powerbi)x\njoin\n(select Sales_Document,Sales_Document_Item,max(LegCount) as LegCount from {catalog_table_name_gold}.{table_name_prefix_gold_src}optilo_infodis_powerbi group by Sales_Document,Sales_Document_Item)y\non x.Sales_Document=y.Sales_Document and x.Sales_Document_Item=y.Sales_Document_Item and x.LegCount=y.LegCount) B\non replace(ltrim(replace(A.Sales_Document, '0', ' ')), ' ', '0')=replace(ltrim(replace(B.Sales_Document, '0', ' ')), ' ', '0') and \nreplace(ltrim(replace(A.Item, '0', ' ')), ' ', '0')=replace(ltrim(replace(B.Sales_Document_Item, '0', ' ')), ' ', '0')\nwhere lower(trim(orderlinestatus))='open'  and \nif(`GMRU.Level7` not in  ('Ultrasound','US') and   -- Updated as per the incident- INC4050771\n\t\t Sales_Doc_Type in ('ZPRO','ZPO','YCQF') and --Material not like 'SP00%'  -- US 3086455\n    SP00Identifier = 'N' and A.Higher_lev_item <> '0' and A.Item_Category not in ('YXCN','YHC2','YHNB','YHNN','YINK','YSNN','YXCK','YYCK','YYDP','YYNK','YYNO','ZMNN','ZEDC') and (case when VendorID is not null and Acct_Grp in ('ZCPD','0001') then 'YES' --step1 \n      when coalesce(Fixed_vendor,'') not in ('')  and len(replace(Ltrim(replace(Fixed_vendor,'0',' ')),' ','0'))>6 then 'YES'  --step2 EBAN \n      when Indicator_Fixed_vendor='X' and len(replace(Ltrim(replace(Vendor_Account_Number,'0',' ')),' ','0'))>6 then 'YES' --step3 EORD \n      else 'NO' end)='NO' -- Thirdpartycheck \n      and Purchasing_Doc is not null\n      and SUBSTRING(Item_Category, 2, 1) NOT IN ('1', '2', '3')\n      and ((DeliveryType = 'Direct shipment' and LAConfirmationDate is null) or (DeliveryType = 'Via Warehouse' and DeliveryDocument is null))\n      and sid not in  (' ','00000000') \n\t\t , (case when coalesce(B.RCDD, ' ')= ' ' and (CDD > SID) then 'Y'\n\t\t\t\t\twhen B.RCDD is not null and (cast(RCDD as date) > SID) then 'Y' --Incident INC4089808\n\t\t\t  end) , 'N' ) ='Y'\n\n/*union all\n\n-- ********************************* this is working but count is more n synapse : 30449 in gold 63947\nselect  distinct  \nSales_Document,\nItem \n,Getdate() as AlertDate\n,'Order_Confirmation_Intime' as AlertName,\n' ' as ActionHolder\nfrom {catalog_table_name_gold}.{table_name_prefix_gold_src}Sales_Line_Measures\nwhere (case when lower(trim(orderlinestatus))='open' and  upper(INCP) ='NO' and coalesce(RDD,' ') <>'2035-12-31' and Purchasing_Doc is null and (Rejection_Reason is null or Rejection_Reason=' ') \nthen ( case when Sales_Doc_Type = 'ZSO' and datediff(CDD,Purchase_Order_Date)>11 then 'Y'\n            when Sales_Doc_Type = 'ZPO' and datediff(CDD,Purchase_Order_Date)>18 then 'Y' end )  \n            else 'N' end )='Y'*/  --updated as per 2996431  -- as per the BUG-3061824, commented this alert\n/*where lower(trim(orderlinestatus))='open' and if(upper(INCP) ='NO' and Sales_D",
          "metadata": {
            "start_token": "7000",
            "end_token": "11000",
            "total_file_tokens": "16732",
            "file_extension": ".py",
            "chunk_id": "2",
            "file_path": "C:\\Users\\320196~1\\AppData\\Local\\Temp\\tmpp8l003o8.py",
            "total_tokens": "4000",
            "file_name": "tmpp8l003o8.py"
          },
          "distance": 1.363223910331726
        }
      ]
    }
  ]
}